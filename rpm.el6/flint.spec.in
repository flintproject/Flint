Summary: A simulator for biological and physiological models
Name: flint
Version: VERSION
Release: RELEASE%{?dist}
License: MIT
URL: https://flintproject.github.io/
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
#BuildRequires: autoconf >= 2.60
BuildRequires: gcc-c++
BuildRequires: make
BuildRequires: flint-boost
BuildRequires: flint-clibsedml
BuildRequires: flint-protobuf
BuildRequires: flint-soslib
BuildRequires: libxml2-devel >= 2.7
Requires: flint-boost
Requires: flint-clibsedml
Requires: flint-protobuf
Requires: flint-soslib
Requires: libxml2 >= 2.7
Requires: make

%description
This is a simulator for biological and physiological models.

%package gui
Summary: The GUI part of Flint
Group: Applications/Productivity
#BuildRequires: ant >= 1.8.0
BuildRequires: java-1.7.0-openjdk-devel
Requires: jre >= 1.7.0
Requires: flint
Requires: gnuplot

%description gui
This is the GUI part of Flint.

%prep
%setup -q

%build
autoreconf -i -f
PKG_CONFIG_PATH=/opt/flint/lib/pkgconfig ./configure --prefix=/opt/flint --with-boost=/opt/flint --with-protoc=/opt/flint/bin/protoc --with-sundials=/opt/flint --enable-release --enable-silent-rules --enable-thread=posix
make
ant -f flint/build.xml jar

%install
rm -rf %{buildroot}
make install DESTDIR=%{buildroot}
mkdir -p %{buildroot}/opt/flint/share/java/lib
install flint/dist/flint.jar %{buildroot}/opt/flint/share/java/
install flint/lib/GarudaSDK-2.0.jar flint/lib/commons-cli-1.3.1.jar flint/lib/commons-io-2.4.jar flint/lib/commons-logging-1.2.jar flint/lib/dom4j-1.6.1.jar flint/lib/jackson-all-1.8.1.jar flint/lib/jcommon-1.0.23.jar flint/lib/jfreechart-1.0.19.jar flint/lib/log4j-1.2.17.jar flint/lib/protobuf-java-2.6.1.jar flint/lib/sqlite-jdbc-3.8.11.2.jar %{buildroot}/opt/flint/share/java/lib/
echo '#!/bin/sh' > %{buildroot}/opt/flint/bin/flint
echo 'export PATH=/opt/flint/bin:$PATH' >> %{buildroot}/opt/flint/bin/flint
echo 'cd /opt/flint' >> %{buildroot}/opt/flint/bin/flint
echo 'exec java -jar /opt/flint/share/java/flint.jar "$@"' >> %{buildroot}/opt/flint/bin/flint
chmod +x %{buildroot}/opt/flint/bin/flint
mkdir -p %{buildroot}/etc/ld.so.conf.d
echo '/opt/flint/lib' > %{buildroot}/etc/ld.so.conf.d/%{name}.conf

%clean
rm -rf %{buildroot}

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%files
%defattr(-,root,root,-)
%doc
/etc/ld.so.conf.d/%{name}.conf
/opt/flint/bin/csv2isd
/opt/flint/bin/flint-*
/opt/flint/bin/isd2csv
/opt/flint/bin/isdbswap
/opt/flint/bin/isdcut
/opt/flint/bin/isddiff
/opt/flint/bin/isdhead
/opt/flint/bin/isdls
/opt/flint/bin/isdmerge
/opt/flint/bin/isdplot
/opt/flint/bin/isdrand
/opt/flint/bin/isdsort
/opt/flint/bin/isdstrip
/opt/flint/bin/isdwc
/opt/flint/lib/libflint.la
/opt/flint/lib/libflint.so
/opt/flint/lib/libflint.so.0
/opt/flint/lib/libflint.so.0.0.0
/opt/flint/lib/libflintxx.la
/opt/flint/lib/libflintxx.so
/opt/flint/lib/libflintxx.so.0
/opt/flint/lib/libflintxx.so.0.0.0
/opt/flint/lib/libsqlite3.la
/opt/flint/lib/libsqlite3.so
/opt/flint/lib/libsqlite3.so.0
/opt/flint/lib/libsqlite3.so.0.0.0

%files gui
%defattr(-,root,root,-)
%doc
/opt/flint/bin/flint
/opt/flint/share/java/flint.jar
/opt/flint/share/java/lib/GarudaSDK-2.0.jar
/opt/flint/share/java/lib/commons-cli-1.3.1.jar
/opt/flint/share/java/lib/commons-io-2.4.jar
/opt/flint/share/java/lib/commons-logging-1.2.jar
/opt/flint/share/java/lib/dom4j-1.6.1.jar
/opt/flint/share/java/lib/jackson-all-1.8.1.jar
/opt/flint/share/java/lib/jcommon-1.0.23.jar
/opt/flint/share/java/lib/jfreechart-1.0.19.jar
/opt/flint/share/java/lib/log4j-1.2.17.jar
/opt/flint/share/java/lib/protobuf-java-2.6.1.jar
/opt/flint/share/java/lib/sqlite-jdbc-3.8.11.2.jar

%changelog
